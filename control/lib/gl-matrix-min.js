/*
 Copyright (c) 2012 Brandon Jones, Colin MacKenzie IV

 This software is provided 'as-is', without any express or implied
 warranty. In no event will the authors be held liable for any damages
 arising from the use of this software.

 Permission is granted to anyone to use this software for any purpose,
 including commercial applications, and to alter it and redistribute it
 freely, subject to the following restrictions:

    1. The origin of this software must not be misrepresented; you must not
    claim that you wrote the original software. If you use this software
    in a product, an acknowledgment in the product documentation would be
    appreciated but is not required.

    2. Altered source versions must be plainly marked as such, and must not
    be misrepresented as being the original software.

    3. This notice may not be removed or altered from any source
    distribution.
*/
(function(A,H){"object"===typeof exports?module.exports=H(global):"function"===typeof define&&define.amd?define([],function(){return H(A)}):H(A)})(this,function(A){function H(a){return r=a}function K(){return r="undefined"!==typeof Float32Array?Float32Array:Array}var I={};(function(){if("undefined"!=typeof Float32Array){var a=new Float32Array(1),b=new Int32Array(a.buffer);I.invsqrt=function(c){a[0]=c;b[0]=1597463007-(b[0]>>1);var d=a[0];return d*(1.5-.5*c*d*d)}}else I.invsqrt=function(a){return 1/
Math.sqrt(a)}})();var r=null;K();var v={create:function(a){var b=new r(3);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):b[0]=b[1]=b[2]=0;return b},createFrom:function(a,b,c){var d=new r(3);d[0]=a;d[1]=b;d[2]=c;return d},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])},add:function(a,b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c},
subtract:function(a,b,c){if(!c||a===c)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c},multiply:function(a,b,c){if(!c||a===c)return a[0]*=b[0],a[1]*=b[1],a[2]*=b[2],a;c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b},scale:function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c},normalize:function(a,b){b||(b=a);var c=a[0],
d=a[1],e=a[2],g=Math.sqrt(c*c+d*d+e*e);if(!g)return b[0]=0,b[1]=0,b[2]=0,b;if(1===g)return b[0]=c,b[1]=d,b[2]=e,b;g=1/g;b[0]=c*g;b[1]=d*g;b[2]=e*g;return b},cross:function(a,b,c){c||(c=a);var d=a[0],e=a[1];a=a[2];var g=b[0],f=b[1];b=b[2];c[0]=e*b-a*f;c[1]=a*g-d*b;c[2]=d*f-e*g;return c},length:function(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)},squaredLength:function(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},direction:function(a,
b,c){c||(c=a);var d=a[0]-b[0],e=a[1]-b[1];a=a[2]-b[2];b=Math.sqrt(d*d+e*e+a*a);if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/b;c[0]=d*b;c[1]=e*b;c[2]=a*b;return c},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);return d},dist:function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)}},L=null,C=new r(4);v.unproject=function(a,b,c,d,e){e||(e=a);L||(L=B.create());var g=L;C[0]=2*(a[0]-d[0])/d[2]-1;C[1]=2*(a[1]-d[1])/d[3]-1;C[2]=
2*a[2]-1;C[3]=1;B.multiply(c,b,g);if(!B.inverse(g))return null;B.multiplyVec4(g,C);if(0===C[3])return null;e[0]=C[0]/C[3];e[1]=C[1]/C[3];e[2]=C[2]/C[3];return e};var P=v.createFrom(1,0,0),Q=v.createFrom(0,1,0),R=v.createFrom(0,0,1),D=v.create();v.rotationTo=function(a,b,c){c||(c=m.create());var d=v.dot(a,b);if(1<=d)m.set(S,c);else if(-.999999>d)v.cross(P,a,D),1E-6>v.length(D)&&v.cross(Q,a,D),1E-6>v.length(D)&&v.cross(R,a,D),v.normalize(D),m.fromAngleAxis(Math.PI,D,c);else{var d=Math.sqrt(2*(1+d)),
e=1/d;v.cross(a,b,D);c[0]=D[0]*e;c[1]=D[1]*e;c[2]=D[2]*e;c[3]=.5*d;m.normalize(c)}1<c[3]?c[3]=1:-1>c[3]&&(c[3]=-1);return c};v.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};var E={create:function(a){var b=new r(9);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8]):b[0]=b[1]=b[2]=b[3]=b[4]=b[5]=b[6]=b[7]=b[8]=0;return b},createFrom:function(a,b,c,d,e,g,f,h,l){var k=new r(9);k[0]=a;k[1]=b;k[2]=c;k[3]=d;k[4]=e;k[5]=g;k[6]=f;k[7]=h;k[8]=l;return k},
determinant:function(a){var b=a[3],c=a[4],d=a[5],e=a[6],g=a[7],f=a[8];return a[0]*(f*c-d*g)+a[1]*(-f*b+d*e)+a[2]*(g*b-c*e)},inverse:function(a,b){var c=a[0],d=a[1],e=a[2],g=a[3],f=a[4],h=a[5],l=a[6],k=a[7],p=a[8],n=p*f-h*k,G=-p*g+h*l,u=k*g-f*l,q=c*n+d*G+e*u;if(!q)return null;q=1/q;b||(b=E.create());b[0]=n*q;b[1]=(-p*d+e*k)*q;b[2]=(h*d-e*f)*q;b[3]=G*q;b[4]=(p*c-e*l)*q;b[5]=(-h*c+e*g)*q;b[6]=u*q;b[7]=(-k*c+d*l)*q;b[8]=(f*c-d*g)*q;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],g=a[2],
f=a[3],h=a[4],l=a[5],k=a[6],p=a[7];a=a[8];var n=b[0],G=b[1],u=b[2],q=b[3],m=b[4],t=b[5],r=b[6],w=b[7];b=b[8];c[0]=n*d+G*f+u*k;c[1]=n*e+G*h+u*p;c[2]=n*g+G*l+u*a;c[3]=q*d+m*f+t*k;c[4]=q*e+m*h+t*p;c[5]=q*g+m*l+t*a;c[6]=r*d+w*f+b*k;c[7]=r*e+w*h+b*p;c[8]=r*g+w*l+b*a;return c},multiplyVec2:function(a,b,c){c||(c=b);var d=b[0];b=b[1];c[0]=d*a[0]+b*a[3]+a[6];c[1]=d*a[1]+b*a[4]+a[7];return c},multiplyVec3:function(a,b,c){c||(c=b);var d=b[0],e=b[1];b=b[2];c[0]=d*a[0]+e*a[3]+b*a[6];c[1]=d*a[1]+e*a[4]+b*a[7];
c[2]=d*a[2]+e*a[5]+b*a[8];return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])&&1E-6>Math.abs(a[3]-b[3])&&1E-6>Math.abs(a[4]-b[4])&&1E-6>Math.abs(a[5]-b[5])&&1E-6>Math.abs(a[6]-b[6])&&1E-6>Math.abs(a[7]-b[7])&&1E-6>Math.abs(a[8]-b[8])},identity:function(a){a||(a=E.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=
0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(!b||a===b){var c=a[1],d=a[2],e=a[5];a[1]=a[3];a[2]=a[6];a[3]=c;a[5]=a[7];a[6]=d;a[7]=e;return a}b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b},toMat4:function(a,b){b||(b=B.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+
", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"}},B={create:function(a){var b=new r(16);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b},createFrom:function(a,b,c,d,e,g,f,h,l,k,p,n,G,u,q,m){var t=new r(16);t[0]=a;t[1]=b;t[2]=c;t[3]=d;t[4]=e;t[5]=g;t[6]=f;t[7]=h;t[8]=l;t[9]=k;t[10]=p;t[11]=n;t[12]=G;t[13]=u;t[14]=q;t[15]=m;return t},set:function(a,
b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])&&1E-6>Math.abs(a[3]-b[3])&&1E-6>Math.abs(a[4]-b[4])&&1E-6>Math.abs(a[5]-b[5])&&1E-6>Math.abs(a[6]-b[6])&&1E-6>Math.abs(a[7]-b[7])&&1E-6>Math.abs(a[8]-b[8])&&1E-6>Math.abs(a[9]-b[9])&&1E-6>Math.abs(a[10]-b[10])&&
1E-6>Math.abs(a[11]-b[11])&&1E-6>Math.abs(a[12]-b[12])&&1E-6>Math.abs(a[13]-b[13])&&1E-6>Math.abs(a[14]-b[14])&&1E-6>Math.abs(a[15]-b[15])},identity:function(a){a||(a=B.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(!b||a===b){var c=a[1],d=a[2],e=a[3],g=a[6],f=a[7],h=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=c;a[6]=a[9];a[7]=a[13];a[8]=d;a[9]=g;a[11]=a[14];a[12]=e;a[13]=f;a[14]=h;
return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b},determinant:function(a){var b=a[0],c=a[1],d=a[2],e=a[3],g=a[4],f=a[5],h=a[6],l=a[7],k=a[8],p=a[9],n=a[10],G=a[11],u=a[12],q=a[13],m=a[14];a=a[15];return u*p*h*e-k*q*h*e-u*f*n*e+g*q*n*e+k*f*m*e-g*p*m*e-u*p*d*l+k*q*d*l+u*c*n*l-b*q*n*l-k*c*m*l+b*p*m*l+u*f*d*G-g*q*d*G-u*c*h*G+b*q*h*G+g*c*m*G-b*f*m*G-k*f*d*a+g*p*d*
a+k*c*h*a-b*p*h*a-g*c*n*a+b*f*n*a},inverse:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],g=a[3],f=a[4],h=a[5],l=a[6],k=a[7],p=a[8],n=a[9],m=a[10],u=a[11],q=a[12],r=a[13],t=a[14],v=a[15],w=c*h-d*f,z=c*l-e*f,x=c*k-g*f,y=d*l-e*h,A=d*k-g*h,B=e*k-g*l,C=p*r-n*q,D=p*t-m*q,J=p*v-u*q,E=n*t-m*r,H=n*v-u*r,I=m*v-u*t,F=w*I-z*H+x*E+y*J-A*D+B*C;if(!F)return null;F=1/F;b[0]=(h*I-l*H+k*E)*F;b[1]=(-d*I+e*H-g*E)*F;b[2]=(r*B-t*A+v*y)*F;b[3]=(-n*B+m*A-u*y)*F;b[4]=(-f*I+l*J-k*D)*F;b[5]=(c*I-e*J+g*D)*F;b[6]=(-q*B+t*x-
v*z)*F;b[7]=(p*B-m*x+u*z)*F;b[8]=(f*H-h*J+k*C)*F;b[9]=(-c*H+d*J-g*C)*F;b[10]=(q*A-r*x+v*w)*F;b[11]=(-p*A+n*x-u*w)*F;b[12]=(-f*E+h*D-l*C)*F;b[13]=(c*E-d*D+e*C)*F;b[14]=(-q*y+r*z-t*w)*F;b[15]=(p*y-n*z+m*w)*F;return b},toRotationMat:function(a,b){b||(b=B.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},toMat3:function(a,b){b||(b=E.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=
a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b},toInverseMat3:function(a,b){var c=a[0],d=a[1],e=a[2],g=a[4],f=a[5],h=a[6],l=a[8],k=a[9],p=a[10],n=p*f-h*k,m=-p*g+h*l,u=k*g-f*l,q=c*n+d*m+e*u;if(!q)return null;q=1/q;b||(b=E.create());b[0]=n*q;b[1]=(-p*d+e*k)*q;b[2]=(h*d-e*f)*q;b[3]=m*q;b[4]=(p*c-e*l)*q;b[5]=(-h*c+e*g)*q;b[6]=u*q;b[7]=(-k*c+d*l)*q;b[8]=(f*c-d*g)*q;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],g=a[2],f=a[3],h=a[4],l=a[5],k=a[6],p=a[7],n=a[8],m=a[9],u=
a[10],q=a[11],r=a[12],t=a[13],v=a[14];a=a[15];var w=b[0],z=b[1],x=b[2],y=b[3];c[0]=w*d+z*h+x*n+y*r;c[1]=w*e+z*l+x*m+y*t;c[2]=w*g+z*k+x*u+y*v;c[3]=w*f+z*p+x*q+y*a;w=b[4];z=b[5];x=b[6];y=b[7];c[4]=w*d+z*h+x*n+y*r;c[5]=w*e+z*l+x*m+y*t;c[6]=w*g+z*k+x*u+y*v;c[7]=w*f+z*p+x*q+y*a;w=b[8];z=b[9];x=b[10];y=b[11];c[8]=w*d+z*h+x*n+y*r;c[9]=w*e+z*l+x*m+y*t;c[10]=w*g+z*k+x*u+y*v;c[11]=w*f+z*p+x*q+y*a;w=b[12];z=b[13];x=b[14];y=b[15];c[12]=w*d+z*h+x*n+y*r;c[13]=w*e+z*l+x*m+y*t;c[14]=w*g+z*k+x*u+y*v;c[15]=w*f+z*p+
x*q+y*a;return c},multiplyVec3:function(a,b,c){c||(c=b);var d=b[0],e=b[1];b=b[2];c[0]=a[0]*d+a[4]*e+a[8]*b+a[12];c[1]=a[1]*d+a[5]*e+a[9]*b+a[13];c[2]=a[2]*d+a[6]*e+a[10]*b+a[14];return c},multiplyVec4:function(a,b,c){c||(c=b);var d=b[0],e=b[1],g=b[2];b=b[3];c[0]=a[0]*d+a[4]*e+a[8]*g+a[12]*b;c[1]=a[1]*d+a[5]*e+a[9]*g+a[13]*b;c[2]=a[2]*d+a[6]*e+a[10]*g+a[14]*b;c[3]=a[3]*d+a[7]*e+a[11]*g+a[15]*b;return c},translate:function(a,b,c){var d=b[0],e=b[1];b=b[2];var g,f,h,l,k,p,n,m,u,q,r,t;if(!c||a===c)return a[12]=
a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;g=a[0];f=a[1];h=a[2];l=a[3];k=a[4];p=a[5];n=a[6];m=a[7];u=a[8];q=a[9];r=a[10];t=a[11];c[0]=g;c[1]=f;c[2]=h;c[3]=l;c[4]=k;c[5]=p;c[6]=n;c[7]=m;c[8]=u;c[9]=q;c[10]=r;c[11]=t;c[12]=g*d+k*e+u*b+a[12];c[13]=f*d+p*e+q*b+a[13];c[14]=h*d+n*e+r*b+a[14];c[15]=l*d+m*e+t*b+a[15];return c},scale:function(a,b,c){var d=b[0],e=b[1];b=b[2];if(!c||a===c)return a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=
d,a[4]*=e,a[5]*=e,a[6]*=e,a[7]*=e,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a;c[0]=a[0]*d;c[1]=a[1]*d;c[2]=a[2]*d;c[3]=a[3]*d;c[4]=a[4]*e;c[5]=a[5]*e;c[6]=a[6]*e;c[7]=a[7]*e;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c},rotate:function(a,b,c,d){var e=c[0],g=c[1];c=c[2];var f=Math.sqrt(e*e+g*g+c*c),h,l,k,p,n,m,u,q,r,t,v,w,z,x,y,A,B,C,D,E;if(!f)return null;1!==f&&(f=1/f,e*=f,g*=f,c*=f);h=Math.sin(b);l=Math.cos(b);k=1-l;b=a[0];f=a[1];p=a[2];n=a[3];
m=a[4];u=a[5];q=a[6];r=a[7];t=a[8];v=a[9];w=a[10];z=a[11];x=e*e*k+l;y=g*e*k+c*h;A=c*e*k-g*h;B=e*g*k-c*h;C=g*g*k+l;D=c*g*k+e*h;E=e*c*k+g*h;e=g*c*k-e*h;g=c*c*k+l;d?a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=b*x+m*y+t*A;d[1]=f*x+u*y+v*A;d[2]=p*x+q*y+w*A;d[3]=n*x+r*y+z*A;d[4]=b*B+m*C+t*D;d[5]=f*B+u*C+v*D;d[6]=p*B+q*C+w*D;d[7]=n*B+r*C+z*D;d[8]=b*E+m*e+t*g;d[9]=f*E+u*e+v*g;d[10]=p*E+q*e+w*g;d[11]=n*E+r*e+z*g;return d},rotateX:function(a,b,c){var d=Math.sin(b);b=Math.cos(b);var e=
a[4],g=a[5],f=a[6],h=a[7],l=a[8],k=a[9],p=a[10],n=a[11];c?a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[4]=e*b+l*d;c[5]=g*b+k*d;c[6]=f*b+p*d;c[7]=h*b+n*d;c[8]=e*-d+l*b;c[9]=g*-d+k*b;c[10]=f*-d+p*b;c[11]=h*-d+n*b;return c},rotateY:function(a,b,c){var d=Math.sin(b);b=Math.cos(b);var e=a[0],g=a[1],f=a[2],h=a[3],l=a[8],k=a[9],p=a[10],n=a[11];c?a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=
e*b+l*-d;c[1]=g*b+k*-d;c[2]=f*b+p*-d;c[3]=h*b+n*-d;c[8]=e*d+l*b;c[9]=g*d+k*b;c[10]=f*d+p*b;c[11]=h*d+n*b;return c},rotateZ:function(a,b,c){var d=Math.sin(b);b=Math.cos(b);var e=a[0],g=a[1],f=a[2],h=a[3],l=a[4],k=a[5],p=a[6],n=a[7];c?a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=e*b+l*d;c[1]=g*b+k*d;c[2]=f*b+p*d;c[3]=h*b+n*d;c[4]=e*-d+l*b;c[5]=g*-d+k*b;c[6]=f*-d+p*b;c[7]=h*-d+n*b;return c},frustum:function(a,b,c,d,e,g,f){f||(f=B.create());
var h=b-a,l=d-c,k=g-e;f[0]=2*e/h;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2*e/l;f[6]=0;f[7]=0;f[8]=(b+a)/h;f[9]=(d+c)/l;f[10]=-(g+e)/k;f[11]=-1;f[12]=0;f[13]=0;f[14]=-(g*e*2)/k;f[15]=0;return f},perspective:function(a,b,c,d,e){a=c*Math.tan(a*Math.PI/360);b*=a;return B.frustum(-b,b,-a,a,c,d,e)},ortho:function(a,b,c,d,e,g,f){f||(f=B.create());var h=b-a,l=d-c,k=g-e;f[0]=2/h;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2/l;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=-2/k;f[11]=0;f[12]=-(a+b)/h;f[13]=-(d+c)/l;f[14]=-(g+e)/k;f[15]=
1;return f},lookAt:function(a,b,c,d){d||(d=B.create());var e,g,f,h,l,k,p,n,m=a[0],r=a[1];a=a[2];f=c[0];h=c[1];g=c[2];p=b[0];c=b[1];e=b[2];if(m===p&&r===c&&a===e)return B.identity(d);b=m-p;c=r-c;p=a-e;n=1/Math.sqrt(b*b+c*c+p*p);b*=n;c*=n;p*=n;e=h*p-g*c;g=g*b-f*p;f=f*c-h*b;(n=Math.sqrt(e*e+g*g+f*f))?(n=1/n,e*=n,g*=n,f*=n):f=g=e=0;h=c*f-p*g;l=p*e-b*f;k=b*g-c*e;(n=Math.sqrt(h*h+l*l+k*k))?(n=1/n,h*=n,l*=n,k*=n):k=l=h=0;d[0]=e;d[1]=h;d[2]=b;d[3]=0;d[4]=g;d[5]=l;d[6]=c;d[7]=0;d[8]=f;d[9]=k;d[10]=p;d[11]=
0;d[12]=-(e*m+g*r+f*a);d[13]=-(h*m+l*r+k*a);d[14]=-(b*m+c*r+p*a);d[15]=1;return d},fromRotationTranslation:function(a,b,c){c||(c=B.create());var d=a[0],e=a[1],g=a[2],f=a[3],h=d+d,l=e+e,k=g+g;a=d*h;var p=d*l,d=d*k,m=e*l,e=e*k,g=g*k,h=f*h,l=f*l,f=f*k;c[0]=1-(m+g);c[1]=p+f;c[2]=d-l;c[3]=0;c[4]=p-f;c[5]=1-(a+g);c[6]=e+h;c[7]=0;c[8]=d+l;c[9]=e-h;c[10]=1-(a+m);c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];c[15]=1;return c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+
a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"}},m={create:function(a){var b=new r(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):b[0]=b[1]=b[2]=b[3]=0;return b},createFrom:function(a,b,c,d){var e=new r(4);e[0]=a;e[1]=b;e[2]=c;e[3]=d;return e},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])&&1E-6>Math.abs(a[3]-
b[3])},identity:function(a){a||(a=m.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}},S=m.identity();m.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];if(!b||a===b)return a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a;b[0]=c;b[1]=d;b[2]=e;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};m.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};m.inverse=function(a,b){var c=a[0],d=a[1],e=a[2],g=a[3],c=(c=c*c+d*d+e*e+g*g)?1/c:0;if(!b||a===b)return a[0]*=-c,a[1]*=-c,a[2]*=-c,a[3]*=c,a;b[0]=
-a[0]*c;b[1]=-a[1]*c;b[2]=-a[2]*c;b[3]=a[3]*c;return b};m.conjugate=function(a,b){if(!b||a===b)return a[0]*=-1,a[1]*=-1,a[2]*=-1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};m.length=function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)};m.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],g=a[3],f=Math.sqrt(c*c+d*d+e*e+g*g);if(0===f)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;f=1/f;b[0]=c*f;b[1]=d*f;b[2]=e*f;b[3]=g*f;return b};m.add=function(a,b,c){if(!c||a===c)return a[0]+=
b[0],a[1]+=b[1],a[2]+=b[2],a[3]+=b[3],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c};m.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],g=a[2];a=a[3];var f=b[0],h=b[1],l=b[2];b=b[3];c[0]=d*b+a*f+e*l-g*h;c[1]=e*b+a*h+g*f-d*l;c[2]=g*b+a*l+d*h-e*f;c[3]=a*b-d*f-e*h-g*l;return c};m.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],g=b[2];b=a[0];var f=a[1],h=a[2];a=a[3];var l=a*d+f*g-h*e,k=a*e+h*d-b*g,m=a*g+b*e-f*d,d=-b*d-f*e-h*g;c[0]=l*a+d*-b+k*-h-m*-f;c[1]=k*a+d*-f+m*
-b-l*-h;c[2]=m*a+d*-h+l*-f-k*-b;return c};m.scale=function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c};m.toMat3=function(a,b){b||(b=E.create());var c=a[0],d=a[1],e=a[2],g=a[3],f=c+c,h=d+d,l=e+e,k=c*f,m=c*h,c=c*l,n=d*h,d=d*l,e=e*l,f=g*f,h=g*h,g=g*l;b[0]=1-(n+e);b[1]=m+g;b[2]=c-h;b[3]=m-g;b[4]=1-(k+e);b[5]=d+f;b[6]=c+h;b[7]=d-f;b[8]=1-(k+n);return b};m.toMat4=function(a,b){b||(b=B.create());var c=a[0],d=a[1],e=a[2],g=a[3],f=
c+c,h=d+d,l=e+e,k=c*f,m=c*h,c=c*l,n=d*h,d=d*l,e=e*l,f=g*f,h=g*h,g=g*l;b[0]=1-(n+e);b[1]=m+g;b[2]=c-h;b[3]=0;b[4]=m-g;b[5]=1-(k+e);b[6]=d+f;b[7]=0;b[8]=c+h;b[9]=d-f;b[10]=1-(k+n);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};m.slerp=function(a,b,c,d){d||(d=a);var e=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3],g,f;if(1<=Math.abs(e))return d!==a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3]),d;g=Math.acos(e);f=Math.sqrt(1-e*e);if(.001>Math.abs(f))return d[0]=.5*a[0]+.5*b[0],d[1]=.5*a[1]+.5*b[1],d[2]=.5*a[2]+
.5*b[2],d[3]=.5*a[3]+.5*b[3],d;e=Math.sin((1-c)*g)/f;c=Math.sin(c*g)/f;d[0]=a[0]*e+b[0]*c;d[1]=a[1]*e+b[1]*c;d[2]=a[2]*e+b[2]*c;d[3]=a[3]*e+b[3]*c;return d};m.fromRotationMatrix=function(a,b){b||(b=m.create());var c=a[0]+a[4]+a[8],d;if(0<c)d=Math.sqrt(c+1),b[3]=.5*d,d=.5/d,b[0]=(a[7]-a[5])*d,b[1]=(a[2]-a[6])*d,b[2]=(a[3]-a[1])*d;else{d=m.fromRotationMatrix.s_iNext=m.fromRotationMatrix.s_iNext||[1,2,0];c=0;a[4]>a[0]&&(c=1);a[8]>a[3*c+c]&&(c=2);var e=d[c],g=d[e];d=Math.sqrt(a[3*c+c]-a[3*e+e]-a[3*g+
g]+1);b[c]=.5*d;d=.5/d;b[3]=(a[3*g+e]-a[3*e+g])*d;b[e]=(a[3*e+c]+a[3*c+e])*d;b[g]=(a[3*g+c]+a[3*c+g])*d}return b};E.toQuat4=m.fromRotationMatrix;(function(){var a=E.create();m.fromAxes=function(b,c,d,e){a[0]=c[0];a[3]=c[1];a[6]=c[2];a[1]=d[0];a[4]=d[1];a[7]=d[2];a[2]=b[0];a[5]=b[1];a[8]=b[2];return m.fromRotationMatrix(a,e)}})();m.identity=function(a){a||(a=m.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};m.fromAngleAxis=function(a,b,c){c||(c=m.create());a*=.5;var d=Math.sin(a);c[3]=Math.cos(a);
c[0]=d*b[0];c[1]=d*b[1];c[2]=d*b[2];return c};m.toAngleAxis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=I.invsqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};m.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};var N={create:function(a){var b=new r(2);a?(b[0]=a[0],b[1]=a[1]):(b[0]=0,b[1]=0);return b},createFrom:function(a,b){var c=new r(2);c[0]=a;c[1]=b;return c},add:function(a,b,c){c||(c=b);c[0]=a[0]+
b[0];c[1]=a[1]+b[1];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=a[1]-b[1];return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=a[1]*b[1];return c},divide:function(a,b,c){c||(c=b);c[0]=a[0]/b[0];c[1]=a[1]/b[1];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;return c},dist:function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},set:function(a,b){b[0]=a[0];b[1]=a[1];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>
Math.abs(a[1]-b[1])},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];return b},normalize:function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1];0<c?(c=Math.sqrt(c),b[0]=a[0]/c,b[1]=a[1]/c):b[0]=b[1]=0;return b},cross:function(a,b,c){a=a[0]*b[1]-a[1]*b[0];if(!c)return a;c[0]=c[1]=0;c[2]=a;return c},length:function(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)},squaredLength:function(a){var b=a[0];a=a[1];return b*b+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]},direction:function(a,b,c){c||(c=a);
var d=a[0]-b[0];a=a[1]-b[1];b=d*d+a*a;if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/Math.sqrt(b);c[0]=d*b;c[1]=a*b;return c},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);return d},str:function(a){return"["+a[0]+", "+a[1]+"]"}},M={create:function(a){var b=new r(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):b[0]=b[1]=b[2]=b[3]=0;return b},createFrom:function(a,b,c,d){var e=new r(4);e[0]=a;e[1]=b;e[2]=c;e[3]=d;return e},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=
a[3];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])&&1E-6>Math.abs(a[3]-b[3])},identity:function(a){a||(a=M.create());a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},transpose:function(a,b){if(!b||a===b){var c=a[1];a[1]=a[2];a[2]=c;return a}b[0]=a[0];b[1]=a[2];b[2]=a[1];b[3]=a[3];return b},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},inverse:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],g=a[3],f=c*g-e*d;if(!f)return null;f=1/
f;b[0]=g*f;b[1]=-d*f;b[2]=-e*f;b[3]=c*f;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],g=a[2];a=a[3];c[0]=d*b[0]+e*b[2];c[1]=d*b[1]+e*b[3];c[2]=g*b[0]+a*b[2];c[3]=g*b[1]+a*b[3];return c},rotate:function(a,b,c){c||(c=a);var d=a[0],e=a[1],g=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=d*b+e*f;c[1]=d*-f+e*b;c[2]=g*b+a*f;c[3]=g*-f+a*b;return c},multiplyVec2:function(a,b,c){c||(c=b);var d=b[0];b=b[1];c[0]=d*a[0]+b*a[1];c[1]=d*a[2]+b*a[3];return c},scale:function(a,b,c){c||(c=a);var d=
a[1],e=a[2],g=a[3],f=b[0];b=b[1];c[0]=a[0]*f;c[1]=d*b;c[2]=e*f;c[3]=g*b;return c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}},O={create:function(a){var b=new r(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):(b[0]=0,b[1]=0,b[2]=0,b[3]=0);return b},createFrom:function(a,b,c,d){var e=new r(4);e[0]=a;e[1]=b;e[2]=c;e[3]=d;return e},add:function(a,b,c){c||(c=b);c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=
a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];c[3]=a[3]*b[3];return c},divide:function(a,b,c){c||(c=b);c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];c[3]=a[3]/b[3];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>
Math.abs(a[2]-b[2])&&1E-6>Math.abs(a[3]-b[3])},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b},length:function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)},squaredLength:function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return b*b+c*c+d*d+a*a},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);d[3]=a[3]+c*(b[3]-a[3]);return d},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};
A&&(A.glMatrixArrayType=r,A.MatrixArray=r,A.setMatrixArrayType=H,A.determineMatrixArrayType=K,A.glMath=I,A.vec2=N,A.vec3=v,A.vec4=O,A.mat2=M,A.mat3=E,A.mat4=B,A.quat4=m);return{glMatrixArrayType:r,MatrixArray:r,setMatrixArrayType:H,determineMatrixArrayType:K,glMath:I,vec2:N,vec3:v,vec4:O,mat2:M,mat3:E,mat4:B,quat4:m}});
